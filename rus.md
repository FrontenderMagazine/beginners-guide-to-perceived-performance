# Руководство по ощущаемой производительности для новичков: 4 способа сделать мобильный сайт удобным как нативное приложение

> Примечание редактора: длина этой статьи ≈3000 слов. В ней рассмотрено 
множество аспектов влияющих на ощущаемую производительность мобильных сайтов, 
а также практических решений для ускорения работы сайта. Вкратце, нас интересует 
не насколько быстрым является сайт, а насколько быстрым он кажется 
пользователям.

![Руководство][Руководство по ощущаемой производительности для новичков]

Разрабатывать хорошо спроектированные сайты для мобильных устройств становится 
всё проще и проще. Не важно какой подход вы выбираете (отзывчивый, адаптивный, 
др.), если вы знаете свое дело, создать привлекательный сайт не составит труда. 

Однако некоторые заказчики хотят чтобы сайтом было пользоваться так же удобно, 
как нативным приложением. Создание этого ощущения остаётся задачей повышенной сложности.

В большинстве случаев когда пользователь говорит, что сайт *похож на 
приложение* или что он оставляет впечатление *«нативности»*, он имеет ввиду не 
внешний вид. На самом деле подразумевается то, как интерфейс реагирует и 
отвечает на действия пользователя.

Нативные приложения работают быстро. Анимация отрисовывается без задержек, 
кнопки срабатывают незамедлительно после нажатия на них, и пользователю не 
приходится ждать пока что-либо загрузится.

**Чтобы ваш сайт был похож на нативное приложение, вам нужно сделать всё 
возможное, чтобы он работал максимально быстро.**

Улучшение производительности — это, на данный момент, очень актуальная тема, и не 
без причины. До недавнего времени в сети прослеживалась чёткая тенденция к 
медленным и тяжёлым сайтам. Сложилось мнение, что создать 
высокопроизводительное веб-приложение невозможно. 

По этой причине [произошёл переход Facebook на нативное приложение][1]. 
Разработчикам не удалось добиться желаемой скорости работы и взаимодействия с 
пользователем, используя доступные ресурсы.

Несмотря на позицию команды Facebook, создание производительных сайтов не 
является чем-то невозможным. Это сложная задача, но она не выходит за рамки наших 
возможностей — просто для её решения требуется больше усилий. С технической точки 
зрения, у нас есть все условия для создания более быстрых, более современных и 
удобных сайтов.

## Ощущаемая и фактическая производительность

Хотя улучшение фактической производительности важно, как оказалось, для 
конечного пользователя она играет не такую уж большую роль, если он не чувствует 
улучшение. 

На конференции An Event Apart в Сиэтле, которая состоялась чуть ранее в этом 
году, Люк Вроблевски (Luke Wroblewski) рассказал [историю о своём мобильном 
приложении Polar][2]. Его команда потратила много усилий, чтобы уменьшить 
продолжительность загрузки новых опросов. 

Также был добавлен индикатор загрузки для уведомления пользователя о том, что 
опрос загружается. Незамедлительно последовали жалобы на то, что новые опросы 
загружаются намного дольше чем раньше, вопреки тому факту, что на самом деле они 
стали загружаться намного быстрее. Разработчики Polar быстро выпустили патч, 
удаляющий индикатор загрузки, и пользователи изумились, насколько сильно 
сократилась продолжительность загрузки опросов. 

Это прекрасная иллюстрация значения ощущаемой производительности. Не важно 
насколько быстрым является ваш сайт, если он не производит впечатление быстрой 
работы. В случае с индикатором загрузки, вместо того чтобы отвлечь пользователя, 
он привлекал его внимание к факту ожидания окончания загрузки. 

**Задача проектировщиков и разработчиков состоит не только в создании сайта, 
быстрого по математическим показателям; она также состоит в создании сайта, 
который производит впечатление быстрого сайта.**

Единственное, что имеет значение — это как пользователь воспринимает скорость 
работы вашего сайта. Любое фактическое ускорение работы сайта является не 
более чем дополнительной вишенкой на торте, который уже и без того хорошо 
украшен. Готов поспорить, что ощущаемая производительность важнее фактической 
производительности. Но это не значит, что над фактической производительностью 
можно не работать совсем. 

Итак, достаточно объяснений. Что можно сделать, чтобы улучшить ощущаемую 
производительность сайта прямо сейчас?

**К вашему вниманию четыре приёма, которые можно начать применять немедленно.**

## 1. Добавление для кнопок состояний при касании

Один из наиболее простых способов улучшить ощущаемую производительность на 
сайте — добавить состояние `active` на мобильных устройствах. 

**Видите ли, когда посетитель касается кнопки на вашем сайте, ему приходится 
ждать 300 мс до того как он видит, что что-то вообще произошло.**

Браузеры добавляют такую задержку, чтобы убедиться, что пользователь не 
собирается продолжить своё действие (точнее говоря, что он не собирается 
сделать двойной тап). Поэтому они ждут чуть меньше трети секунды, чтобы 
посмотреть, что пользователь будет делать дальше и, если он ничего не делает, 
реагируют на изначальное касание. Когда реакция наконец происходит, об этом 
свидетельствует только наложение серого цвета, после чего происходит выполнение 
действия. 

Это пример отвратительного взаимодействия с пользователем. Согласно результатам 
исследования, проведённого консалтинговой компанией Nielsen Norman Group, всё, 
на выполнение чего требуется более 100 мс, создаёт у пользователя впечатление 
ожидания, в то время когда его главная цель — это перемещение по вашему сайту.

Тем не менее, на большинстве мобильных сайтов, в том числе и нескольких, 
разработанных мной, эта проблема ощущаемой производительности никаким образом не 
решается. Разработчики обычно оставляют исходное состояние касания для ссылок и 
кнопок неизменным. 

**Чтобы ваш сайт казался более быстрым, нужно сделать так, чтобы кнопки 
реагировали на касание пользователя незамедлительно, и чтобы пользователь получал 
визуальное подтверждение, что что-то происходит.**

Для визуального обозначения нажатия на кнопку или ссылку есть замечательный 
признак — это состояние `:active`. Мы постоянно используем его для десктопных
браузеров. 

К сожалению, ни iOS, ни Android не обращают внимания на этот псевдокласс во время 
взаимодействия с кнопкой или ссылкой на мобильном устройстве. Чтобы сделать 
возможным состояние активности, нужно добавить на страницу простое
JavaScript-событие:

    document.addEventListener("touchstart", function(){}, true)

Затем вам понадобится CSS, чтобы добавить состояние активности и убрать 
перекрытие кнопки серым цветом при касании:

    -webkit-tap-highlight-color: rgba(0,0,0,0);

После применения этих двух свойств и настройки состояния активности, сразу же 
возникает впечатление что кнопки реагируют намного быстрее, хотя по сути 
скорость их реакции не отличается. Просто пользователи получают незамедлительный 
отклик на свои действия, вместо того чтобы ждать 300 мс до какого-либо ответа.

![Без состояния активности][Без состояния активности]

Без состояния активности ([код][4]).

![С состоянием активности][С состоянием активности]

С состоянием активности ([код][5])

**Однако если вы хотите, чтобы они на самом деле срабатывали без промедления, 
можно сделать ещё кое-что.**

С помощью функции JavaScript под названием `fasttap` или `fastclick`, можно 
полностью избавиться от задержки в 300 мс перед срабатыванием кнопки. Благодаря 
этой функции и состоянию активности ваш сайт будет казаться чертовски быстрым. 

Больше информации о `fasttap` можно найти в [этой статье от Google][6], готовую 
к использованию реализацию можно найти [в этом репозитории на Github][7].

## 2. Используйте прокрутку с ускорением

Случалось ли вам создавать контейнер с прокруткой для мобильного сайта и 
сталкиваться с проблемой медленного, неотзывчивого прокручивания, установленного 
по умолчанию?

Наконец вам повезло! Android 3+ и iOS 5+ ввели новое свойство 
`overflow-scrolling`, которое активирует прокрутку с ускорением. Теперь всё 
работает превосходно.

![Прокрутка без ускорения][Прокрутка без ускорения]

Прокрутка без ускорения ([код][8])

![Прокрутка с ускорением][Прокрутка с ускорением]

Прокрутка с ускорением ([код][9])

Прокрутка с ускорением *кажется* вполне естественной, потому что таковой она и 
*является*. Вам нужно всего лишь добавить это свойство для контейнера с 
прокруткой:

    -webkit-overflow-scrolling: touch;

У этого свойства, однако, есть один недостаток: оно отключает возможность 
обратной прокрутки в верхнюю часть страницы через касание строки 
состояния в верхней части вашего iPhone. Эта ошибка существует уже довольно 
давно и даже [в самой последней версии Mobile Safari под iOS 7][10] она пока не 
исправлена.

Обойти её можно создав класс, добавляющий для контейнера 
`overflow-scrolling: touch`, и применяя этот класс с помощью JavaScript только 
когда контейнер является видимым. 

Для Android 4 применять это свойство нет надобности, там для каждого контейнера с 
прокруткой прокрутка с ускорением используется по умолчанию.

Для старших версий Android есть несколько решений. Моё любимое — определение 
поддержки прокрутки с ускорением с помощью Modernizr и применение для контейнера 
`overflow:visible`. Если этот вариант не подходит, есть несколько библиотек 
JavaScript, которые можно использовать вместо него. [Overthrow][11] и [iScroll][12] 
от команды Filament Group вполне неплохо подойдут.

## 3. Создавайте высокопроизводительную анимацию

Одно из наиболее заметных отличий между сайтами и приложениями состоит в 
использовании анимации.

У разработчиков приложений есть возможность по максимуму использовать аппаратное 
ускорение графики, уже много лет доступное во всех современных устройствах. 
Разработчики сайтов вынуждены довольствоваться анимацией на основе JavaScript, 
которая на мобильных устройствах со слабым процессором воспроизводится довольно 
медленно. 

Однако при текущей поддержке мобильными браузерами можно достичь хорошего 
результата используя в проектах аппаратно-ускоренную анимацию на CSS3.

**Это отличный способ добавить немного визуального шика, которым многие годы 
щеголяют наши любимые приложения.**

Однако, не так быстро! Чтобы анимация казалась естественной, нужно убедиться что 
она не тормозит и не дёргается, что может быть не так уж просто.

Аллен Пайк (Allen Pike) из студии Steamclock Software написал в [2011 году 
замечательную статью][13] об удовольствии, которое пользователи получают от 
анимации и о том, насколько сильно некачественная анимация может испортить 
впечатление от использования приложения.

Что интересно, он написал статью о разработке нативных приложений, таким образом, 
она является отличным образцом для подражания, если перед нами стоит задача
создать естественную анимацию для сайта. 

В этой статье он описал так называемую «временную шкалу восприятия»:

**1. Анимация должна проигрываться с частотой 60 кадров в секунду.** Это значит, 
что на каждый кадр должно [приходиться ~16 мс][14]. Это минимальная скорость, 
при которой создаётся впечатление естественности и плавности. Частота 60 кадров 
в секунду используется во всей встроенной анимации iOS; именно поэтому прокрутка 
на iPhone кажется намного более плавной, чем на устройстве с Android (хотя 
Google недавно провела ряд совершенствований в этой области). Необходимо 
стремиться к такой скорости для всей анимации, которая используется во время 
взаимодействием с пользователем.

**2. Всё остальное должно отвечать не позднее чем через 100 мс.** Это 
значение — психологическая грань, за которой всё кажется медленным. Всё, что 
происходит быстрее чем за 100 мс, кажется пользователю фактически мгновенным.

**3. Если продолжительность действия никак не вписывается в 100 мс, оно 
обязательно должно завершиться не позже чем через 1000 мс.** Аллен считает что 
именно такой промежуток времени даёт пользователю ощущение что что-то происходит, 
как при использовании индикатора загрузки.

Однако, как мы узнали ранее из примера с приложением Polar, привлечение внимания 
пользователя к ожиданию скорее вредит чем приносит пользу. Я расскажу об 
альтернативном методе решения этого вопроса немного позже. 

**4. Всё, что длится дольше секунды**, скорее всего, никуда не годится, и вам 
стоит об этом побеспокоиться.

Итак, после всего этого вы уже, наверное, разбили клавиатуру вдребезги и 
задумались над сменой профессии — с каких это пор веб-разработка включает в себя 
заботу о таких вещах, как расчёт продолжительности анимации? 

**Не волнуйтесь, существует несколько чудесных инструментов, которые существенно 
облегчат вам жизнь.**

Первый из них — новая библиотека [Effeckt.css][15] от классных 
ребят-разработчиков HTML5 Boilerplate. Они поставили перед собой цель создать 
библиотеку популярных переходов и анимаций с частотой 60 кадров в секунду. Хотя 
работа над библиотекой ещё не завершена, большая её часть работает отлично и я 
настоятельно рекомендую использовать её и подстраивать под ваш проект. 

Ещё одна прекрасная библиотека — [Topcoat][16]. Это библиотека компонентов CSS 
от команды разработчиков из Adobe, созданная с учётом производительности. Эта 
библиотека доверху наполнена отменными компонентами, которые воспроизводятся 
удивительно плавно. Так как главной целью разработчиков является 
производительность, для каждого компонента [реализована возможность её оценки][17]. 

Вообще-то, Topcoat и Effeckt.css неразрывно связаны. Topcoat напрямую вносит 
вклад в репозиторий Effeckt.css и вместе они работают просто прекрасно.

**Дальше, как я уже обещал, я расскажу как можно избежать использования 
индикаторов загрузки.**

Один из моих любимых методов избежания использования индикаторов загрузки, когда 
время ожидания больше 100 мс, но меньше чем, скажем, 250 мс (когда индикатор 
загрузки скорее принесёт вред чем пользу) — это маскировка ожидания с помощью 
анимации.

Например, если вы вставляете контент на страницу с помощью Ajax, попробуйте 
добавить анимацию для контейнера, в который будет вставлен контент, так чтобы 
этот контейнер сжимался и затем расширялся под размеры вставленного контента. 
Короткая анимация такого рода отвлечёт пользователя от факта ожидания — вместо 
того, чтобы смотреть на индикатор загрузки, он просто ждёт окончания короткой 
анимации. Он может и вовсе не заметить, что контент был загружен с отсрочкой.

Разумеется, повторяющаяся длительная анимация может быть раздражающей, так что 
используйте этот приём умеренно. Это будет хорошим советом для большинства 
анимаций.

## 4. Используйте естественные жесты

Одно из преимуществ приложений над сайтами — жесты, которые легко осваиваются
пользователями сенсорных устройств.

Разработчики приложений осознают огромный потенциал жестов и используют его в 
своих целях.

[Mailbox][18] и [Clear][19] служат прекрасным примером. В этих приложениях 
используются простые жесты, основой для которых служит отличительное свойство 
мобильных устройств — возможность прикасаться к объектам прямо на экране. 

На большинстве сайтов возможен только тап по объектам. Разработчики избегают 
использования других жестов, что оставляет пользователя с чувством собственной 
неполноценности. 

**Мы должны разрабатывать сайты с учётом возможностей устройств. Если устройство 
пользователя поддерживает жесты, почему бы этим не воспользоваться?**

Есть одна маленькая проблема: у операционных систем на мобильных устройствах 
есть неприятная привычка монополизировать жесты в браузере для своих «гнусных» 
целей. 

Например, в приложениях вроде Facebook боковой свайп из правой и левой части 
экрана используется для открытия навигации. Однако в веб это взаимодействие 
запрещено, так как в Chrome оно используется для переключения между вкладками, а 
в новой версии Mobile Safari под iOS 7 — [для навигации по истории][20].

Ладно, эти жесты под запретом. Какие тогда можно и нужно использовать? Вот 
список из четырех:

### Жест №1. Свайп в сторону

Хотя боковой свайп под табу, свайп в сторону — не менее классный жест. Только 
нужно следить, чтобы он начинался не слишком близко от края экрана. 

Этот жест лучше всего использовать для перемещения по набору объектов: например 
по карусели фотографий или списку вкладок.

### Жест №2. Потянуть для обновления

«Потянуть для обновления» — это ещё один жест, который люди схватывают на лету. 
Есть несколько прекрасных библиотек JavaScript, с помощью которых можно запросто 
подключить это действие. Я пользуюсь [Hook.js][21].

### Жест №3. Длинное нажатие

Существует полезное свойство `-webkit-touch-callout: none;`, которое позволяет 
отключить действие по умолчанию для длинного нажатия в Mobile Safari. Чтобы 
сделать то же в Android, придётся [приложить немного больше усилий][22].

Жест длинного нажатия можно использовать для действий вроде перемещения 
элементов (например, для изменения порядка элементов в списке) или отображения 
дополнительных возможностей (например, возможность репоста в соцсетях).

### Жест №4. Пинч для масштабирования

Всем известен такой жест, как пинч для масштабирования. Большинство людей, 
увидев фотографию в сети попробует использовать пинч, чтобы увеличить и 
рассмотреть её более подробно. 

Это очередной случай когда браузер монополизирует жест, но в данном случае всё 
не так плохо. 

Вне зависимости от того, блокируете ли вы масштабирование области просмотра или 
нет, иногда увеличение всей страницы при использовании пинча нежелательно. 
Управлять такими мультитач-жестами можно с помощью маленькой, но замечательной 
библиотеки [Hammer.js][23]. Эта библиотека позволяет использовать множество 
встроенных жестов, а также создавать собственные. 

Отличный пример представляет увеличение изображений посредством пинча [на 
мобильном сайте imgur.com][24]. Когда вы зайдете на него в следующий раз, 
посмотрите что можно сделать, используя свайп.

Только помните, используя жест, следует убедиться, что он либо кажется 
естественным, либо является нужным для пользователя.

## Заключение

Я очень надеюсь, что придёт день, когда исчезнет необходимость в разграничении 
нативных приложений и сайтов. Мы к этому ещё не пришли, но чем больше мы 
прилагаем усилий, чтобы все наши сайты создавали впечатление разработанных с 
учётом потребностей пользователя, тем скорее этот день наступит. 

**Мне кажется, что наблюдаемое сейчас повышенное внимание производительности — это 
прекрасно, но не стоит забывать, что наши пользователи — не машины.**

Им все равно сколько запросов делает ваш сайт или как быстро происходит 
отрисовка страницы. Однако для них имеет значение то, на что эти факторы влияет — 
их впечатление о производительности.

**Сосредоточьтесь на том, чтобы ваш сайт выглядел и вёл себя так, как будто он 
работает максимально быстро. Нет смысла создавать самый быстрый в мире сайт если 
пользователь не чувствует его скорость.**

Если у вас есть ещё советы по улучшению ощущаемой производительности, пожалуйста, 
разместите их в комментариях.

[1]: http://www.infoq.com/news/2012/09/Facebook-HTML5-Native
[2]: http://www.lukew.com/ff/entry.asp?1797
[3]: http://www.nngroup.com/articles/response-times-3-important-limits/
[4]: http://codepen.io/mobify/full/ulwqf
[5]: http://codepen.io/mobify/full/ulwqf
[6]: https://developers.google.com/mobile/articles/fast_buttons
[7]: https://github.com/ftlabs/fastclick
[8]: http://codepen.io/mobify/full/LueFn
[9]: http://codepen.io/mobify/full/vLcky
[10]: http://www.mobify.com/blog/designing-for-ios-7/
[11]: http://filamentgroup.github.io/Overthrow/
[12]: http://cubiq.org/iscroll-4
[13]: http://www.allenpike.com/2011/providing-joy-at-60-fps/
[14]: https://speakerdeck.com/jaffathecake/rendering-without-lumps
[15]: https://github.com/h5bp/Effeckt.css
[16]: http://topcoat.io/
[17]: http://bench.topcoat.io/
[18]: http://www.mailboxapp.com/
[19]: http://www.realmacsoftware.com/clear/
[20]: http://www.mobify.com/blog/designing-for-ios-7/
[21]: http://usehook.com/
[22]: http://stackoverflow.com/questions/3413683/disabling-the-context-menu-on-long-taps-on-android
[23]: http://eightmedia.github.io/hammer.js/
[24]: http://imgur.com/gallery/U6HYTnm

[Руководство по ощущаемой производительности для новичков]: img/perceived-performance.png
[Без состояния активности]: img/notapstate.gif
[С состоянием активности]: img/tapstate.gif
[Прокрутка без ускорения]: img/nooverflowscroll.gif
[Прокрутка с ускорением]: img/overflowscroll.gif
